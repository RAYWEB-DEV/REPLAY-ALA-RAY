<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>JKT48 Replay Theater</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0b0b0b;
  color:#fff
}
header{
  background:#111;
  padding:12px;
  text-align:center;
  border-bottom:2px solid #c00000
}
header img{height:42px}
.container{max-width:1200px;margin:auto;padding:15px}
.theater{display:flex;gap:15px}

/* VIDEO */
.video-wrapper{
  flex:2;
  aspect-ratio:16/9;
  background:#000;
  border-radius:10px;
  overflow:hidden
}
#player{width:100%;height:100%}

/* SIDEBAR */
.sidebar{
  flex:1;
  background:#111;
  border-radius:10px;
  display:flex;
  flex-direction:column
}
.tabs{
  display:flex
}
.tab{
  flex:1;
  padding:10px;
  text-align:center;
  cursor:pointer;
  background:#222
}
.tab.active{
  background:#c00000
}
.playlist{
  flex:1;
  overflow-y:auto
}
.playlist-item{
  padding:10px;
  border-bottom:1px solid #222;
  cursor:pointer
}
.playlist-item:hover{background:#1a1a1a}

/* ADMIN */
.admin-panel{
  display:none;
  padding:10px;
  border-top:1px solid #222
}
.admin-panel input,
.admin-panel select,
.admin-panel button{
  width:100%;
  margin-top:6px;
  padding:8px
}

/* MOBILE */
@media(max-width:768px){
  .theater{flex-direction:column}
}
</style>
</head>

<body>
<header>
  <img src="logo.png">
  <h2>JKT48 Replay Theater</h2>
</header>

<div class="container">
  <div class="theater">

    <div class="video-wrapper">
      <div id="player"></div>
    </div>

    <div class="sidebar">

      <div class="tabs">
        <div class="tab active" onclick="switchTab('normal')">Replay</div>
        <div class="tab" onclick="switchTab('birthday')">Ultah</div>
      </div>

      <div class="playlist" id="playlist"></div>

      <div class="admin-panel" id="adminPanel">
        <select id="category">
          <option value="normal">Replay</option>
          <option value="birthday">Ultah</option>
        </select>
        <input id="titleInput" placeholder="Judul Replay">
        <input id="videoInput" placeholder="YouTube Video ID">
        <button onclick="addPlaylist()">Tambah</button>
      </div>

    </div>

  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  deleteDoc, doc, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* CONFIG */
const ADMIN_KEY="WOTSSUPPLY_48";
const firebaseConfig={
  apiKey: "AIzaSyB0duPBEMm2V1lVxNKPZLZ6B5Jd4lANhh8",
  authDomain: "jkt48-replay.firebaseapp.com",
  projectId: "jkt48-replay"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let MODE="normal";
let player;

/* ADMIN CHECK */
if(location.hash==="#admin="+ADMIN_KEY){
  adminPanel.style.display="block";
}

/* PLAYER */
window.onYouTubeIframeAPIReady=()=>{
  player=new YT.Player("player",{playerVars:{controls:0,rel:0}});
};

/* REALTIME LIST */
const list=document.getElementById("playlist");

onSnapshot(collection(db,"playlists"),snap=>{
  list.innerHTML="";
  snap.forEach(d=>{
    const data=d.data();
    if(data.category!==MODE) return;

    const div=document.createElement("div");
    div.className="playlist-item";
    div.textContent=data.title;
    div.onclick=()=>player.loadVideoById(data.videoId);

    if(isAdmin()){
      const del=document.createElement("span");
      del.textContent=" âœ•";
      del.style.color="red";
      del.onclick=(e)=>{
        e.stopPropagation();
        deleteDoc(doc(db,"playlists",d.id));
      };
      div.appendChild(del);
    }
    list.appendChild(div);
  });
});

/* FUNCTIONS */
function isAdmin(){
  return location.hash==="#admin="+ADMIN_KEY;
}
window.switchTab=(m)=>{
  MODE=m;
  document.querySelectorAll(".tab")
    .forEach(t=>t.classList.remove("active"));
  event.target.classList.add("active");
};
window.addPlaylist=async()=>{
  if(!titleInput.value||!videoInput.value) return;
  await addDoc(collection(db,"playlists"),{
    title:titleInput.value,
    videoId:videoInput.value,
    category:category.value,
    createdAt:Date.now()
  });
  titleInput.value="";
  videoInput.value="";
};
</script>
</body>
</html>
